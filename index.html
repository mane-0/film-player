<!DOCTYPE html>
<html lang="ckb" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Video Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    
    <style>
        /* ڕێکخستنی گشتی */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        
        #player-container {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
        }

        /* --- ستایلی دوگمەی پەڕینەوە --- */
        .skip-overlay {
            position: absolute;
            bottom: 80px; /* بەرزتر کراوەتەوە بۆ ئەوەی نەکەوێتە ژێر کۆنترۆڵەکان */
            right: 20px; 
            z-index: 999999 !important; /* زۆر گرنگە: بۆ ئەوەی لەسەرووی هەموو شتێک بێت */
            display: none; /* سەرەتا دیار نییە */
        }

        #btn-skip {
            background-color: rgba(0, 0, 0, 0.85);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto; /* دڵنیابوونەوە لەوەی کلیک وەردەگرێت */
        }

        #btn-skip:hover { background-color: rgba(255, 0, 0, 0.8); border-color: red; }
        #btn-skip:disabled { opacity: 0.5; cursor: wait; background-color: rgba(0,0,0,0.5); border-color: gray; }
        #btn-skip:disabled:hover { background-color: rgba(0,0,0,0.5); }

        /* --- شاردنەوەی کۆنترۆڵەکان کاتی ڕیکلام --- */
        /* کاتێک کلاس-ی ad-mode زیاد دەکرێت، هێڵی کات دەشارێتەوە */
        .ad-mode .plyr__controls__item.plyr__progress__container,
        .ad-mode .plyr__controls__item.plyr__time,
        .ad-mode .plyr__menu {
            display: none !important;
        }
        
        /* پەیامی هەڵە */
        .error-screen { color: white; text-align: center; display: none; }
    </style>
</head>
<body>

<div id="player-container">
    <video id="player" playsinline controls crossorigin></video>
    
    <!-- شوێنی دوگمەکە -->
    <div class="skip-overlay">
        <button id="btn-skip" disabled>ئامادەکردن...</button>
    </div>
    
    <div id="error-msg" class="error-screen">
        <h3>تکایە لینک دابنێ (?url=...)</h3>
    </div>
</div>

<!-- Plyr JS -->
<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

<script>
    // =========================================================
    // ١. لێرە لینکی ڕیکلامەکەی خۆت دابنێ
    const MY_AD_URL = 'https://ia601007.us.archive.org/7/items/kurdflix-intro/IMG_1015.mp4';
    // =========================================================

    // وەرگرتنی توخمی HTML
    const videoElement = document.getElementById('player');
    const container = document.getElementById('player-container');
    const skipOverlay = document.querySelector('.skip-overlay');
    const skipBtn = document.getElementById('btn-skip');
    const errorMsg = document.getElementById('error-msg');

    // وەرگرتنی لینکی فیلم لە URL
    const urlParams = new URLSearchParams(window.location.search);
    const MOVIE_URL = urlParams.get('url');

    // --- لۆجیکی سەرەکی ---
    
    let currentState = 'ad'; // ad = ڕیکلام، movie = فیلم
    let timerInterval;

    if (!MOVIE_URL) {
        // ئەگەر لینک نەبوو، ڕیکلام و ڤیدیۆ لادەبەین و هەڵە نیشان دەدەین
        videoElement.style.display = 'none';
        errorMsg.style.display = 'block';
    } else {
        // هەنگاوی یەکەم: بارکردنی ڕیکلامەکە وەک یەکەم ڤیدیۆ
        // تێبینی: ئێمە یەکسەر ڕیکلامەکە دادەنێین بۆ ئەوەی کێشە دروست نەبێت
        videoElement.src = MY_AD_URL;
        container.classList.add('ad-mode'); // شاردنەوەی هێڵی کات
    }

    // دروستکردنی Plyr
    const player = new Plyr(videoElement, {
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen', 'settings'],
        autoplay: false,
        clickToPlay: true,
        keyboard: { focused: true, global: true }
    });

    // کاتێک ڤیدیۆ (ڕیکلام) دەست پێ دەکات
    player.on('play', () => {
        if (currentState === 'ad') {
            // نیشاندانی دوگمەی پەڕینەوە
            skipOverlay.style.display = 'block';
            
            // ئەگەر تایمەر پێشتر کاری نەکردبێت، کاری پێ بکە
            if (!timerInterval) {
                startCountdown(5); // ٥ چرکە
            }
        }
    });

    // کاتێک ڕیکلام تەواو دەبێت
    player.on('ended', () => {
        if (currentState === 'ad') {
            loadMovie();
        }
    });

    // فەنکشنی ژماردنی کات (Countdown)
    function startCountdown(seconds) {
        let counter = seconds;
        skipBtn.innerText = `پەڕینەوە دوای (${counter})`;
        skipBtn.disabled = true;

        timerInterval = setInterval(() => {
            counter--;
            if (counter > 0) {
                skipBtn.innerText = `پەڕینەوە دوای (${counter})`;
            } else {
                // کات تەواو بوو
                clearInterval(timerInterval);
                skipBtn.innerText = 'پەڕینەوە لە ڕیکلام »';
                skipBtn.disabled = false;
                
                // ئێستا دەتوانرێت کلیک بکرێت
            }
        }, 1000);
    }

    // فەنکشنی گۆڕین بۆ فیلمی سەرەکی
    function loadMovie() {
        // ڕاگرتنی هەر تایمەرێک ئەگەر مابێت
        clearInterval(timerInterval);
        
        // گۆڕینی دۆخ
        currentState = 'movie';
        
        // شاردنەوەی دوگمە و لابردنی ستایلی ڕیکلام
        skipOverlay.style.display = 'none';
        container.classList.remove('ad-mode');
        
        // گۆڕینی لینک بۆ فیلمە ئەسڵییەکە
        player.source = {
            type: 'video',
            sources: [
                { src: MOVIE_URL, type: 'video/mp4' }
            ]
        };

        // لێدانی فیلمەکە
        setTimeout(() => {
            player.play();
        }, 200);
    }

    // ڕووداوی کلیک لەسەر دوگمەی پەڕینەوە
    skipBtn.addEventListener('click', (e) => {
        // زۆر گرنگ: ڕێگری دەکات کلیکەکە بگوازرێتەوە بۆ خوارەوە
        e.stopPropagation(); 
        
        // جێبەجێکردنی گۆڕینەکە
        loadMovie();
    });

</script>

</body>
</html>
