<!DOCTYPE html>
<html lang="ckb" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Kurd Movie Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    
    <style>
        body { margin: 0; background: #000; overflow: hidden; height: 100vh; font-family: sans-serif; }
        
        :root { --plyr-color-main: #e50914; }

        #player-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex; align-items: center; justify-content: center;
        }
        #player-container .plyr { width: 100%; height: 100%; }

        /* ستایلی دوگمەی پەڕینەوە */
        .ad-overlay {
            position: absolute; bottom: 60px; right: 20px; z-index: 50; display: none;
        }
        #skip-ad-button {
            background-color: rgba(0, 0, 0, 0.8); color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px;
            pointer-events: auto; /* دڵنیابوونەوە لەوەی دادەگیرێت */
        }
        #skip-ad-button:disabled { opacity: 0.6; cursor: not-allowed; }
        
        /* ---- گرنگ: شاردنەوەی هێڵی کات لە کاتی ڕیکلام ---- */
        /* تەنها هێڵی کات و سیتیەکان دەشارینەوە، نەک دوگمەی پلی */
        .ad-active .plyr__progress { display: none !important; }
        .ad-active .plyr__time { display: none !important; }
        .ad-active .plyr__menu { display: none !important; }
        /* ------------------------------------------------ */

        /* پەیامی هەڵە */
        .error-msg { color: white; text-align: center; direction: ltr; }
    </style>
</head>
<body>

<div id="player-container">
    <video id="player" playsinline controls crossorigin poster="https://i.postimg.cc/pybMsYh3/0x0.webp"></video>
    
    <div class="ad-overlay">
        <button id="skip-ad-button" disabled>تکایە چاوەڕێ بکە...</button>
    </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
<script>
    // ==============================================================
    // لینکی ڕیکلامەکەت لێرە دابنێ
    const AD_URL = 'https://ia601007.us.archive.org/7/items/kurdflix-intro/IMG_1015.mp4';
    // ==============================================================

    const urlParams = new URLSearchParams(window.location.search);
    const MOVIE_URL = urlParams.get('url');
    
    const videoElement = document.getElementById('player');
    const container = document.getElementById('player-container');
    const skipBtn = document.getElementById('skip-ad-button');
    const adOverlay = document.querySelector('.ad-overlay');

    if (!MOVIE_URL) {
        document.body.innerHTML = '<div class="error-msg"><h2>No URL Provided</h2><p>Add ?url=YOUR_LINK at the end.</p></div>';
    } else {
        // فیلمەکە دادەنێین بەڵام هێشتا لێی نادەین
        videoElement.src = MOVIE_URL;
    }

    // ڕێکخستنی پلەیەر
    const player = new Plyr(videoElement, {
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen', 'settings'],
        keyboard: { focused: true, global: true },
        // ئەمە گرنگە بۆ ئەوەی ڕێگە بدات لەسەر مۆبایل داگیرێت
        clickToPlay: true 
    });

    let adHasBeenPlayed = false;
    let isAdMode = false;
    let countdownInterval;

    // کاتێک بەکارهێنەر یەکەم جار پلەی دەکات
    player.on('play', function(event) {
        // ئەگەر ڕیکلامەکە هێشتا لێنەدراوە و لینکی فیلمەکەش هەیە
        if (!adHasBeenPlayed && MOVIE_URL) {
            
            // دەستبەجێ فیلمەکە ڕادەگرین پێش ئەوەی دەست پێ بکات
            // player.pause() لێرە بەکارناهێنین چونکە ڕەنگە کێشە دروست بکات
            // بەڵکو ڕاستەوخۆ سۆرسەکە دەگۆڕین
            
            adHasBeenPlayed = true; // نیشانەیەک کە ڕیکلامەکە دەستی پێکرد
            isAdMode = true;

            // گۆڕینی دیزاین بۆ دۆخی ڕیکلام (شاردنەوەی هێڵی کات)
            container.classList.add('ad-active');
            adOverlay.style.display = 'block';

            // گۆڕینی ڤیدیۆ بۆ ڕیکلام
            // گرنگ: ئێمە src دەگۆڕین و یەکسەر فەرمانی play دەدەین
            videoElement.src = AD_URL;
            
            // چاوەڕێ دەکەین تا ڤیدیۆکە ئامادە دەبێت ئینجا پلەی دەکەین
            videoElement.load();
            var playPromise = videoElement.play();

            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // ئۆتۆماتیکی دەستی پێکرد
                    startCountdown(5);
                }).catch(error => {
                    // ئەگەر براوسەرەکە ڕێگەی نەدا ئۆتۆماتیکی کار بکات
                    // کێشە نییە، بەکارهێنەر دەتوانێت دوگمەی Play دابگرێت چونکە قوفڵمان نەکردووە
                    startCountdown(5);
                });
            }
        }
    });

    // کاتێک ڕیکلام تەواو دەبێت
    player.on('ended', () => {
        if (isAdMode) {
            skipAd();
        }
    });

    function startCountdown(seconds) {
        let counter = seconds;
        skipBtn.textContent = `پەڕینەوە دوای (${counter})`;
        skipBtn.disabled = true;

        if (countdownInterval) clearInterval(countdownInterval);

        countdownInterval = setInterval(() => {
            counter--;
            if (counter > 0) {
                skipBtn.textContent = `پەڕینەوە دوای (${counter})`;
            } else {
                clearInterval(countdownInterval);
                skipBtn.textContent = 'پەڕینەوە لە ڕیکلام »';
                skipBtn.disabled = false;
            }
        }, 1000);
    }

    function skipAd() {
        if (!isAdMode) return;
        
        clearInterval(countdownInterval);
        isAdMode = false;
        
        // گەڕاندنەوەی دیزاینی ئاسایی
        container.classList.remove('ad-active');
        adOverlay.style.display = 'none';

        // گەڕانەوە بۆ فیلمە ئەسڵییەکە
        videoElement.src = MOVIE_URL;
        videoElement.load();
        videoElement.play();
    }

    skipBtn.addEventListener('click', (e) => {
        // ڕێگری دەکەین لەوەی کلیکەکە بگاتە پلەیەرەکە
        e.stopPropagation(); 
        skipAd();
    });

</script>

</body>
</html>
